<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Abriendo Spotify...</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto;
      display:flex; align-items:center; justify-content:center;
      height:100vh; margin:0;
      background:#f2f3f5; color:#222;
    }
    .card {
      text-align:center;
      max-width:400px;
      padding:24px;
      border-radius:16px;
      background:#fff;
      box-shadow:0 8px 24px rgba(0,0,0,.08);
    }
    a {
      display:inline-block;
      margin:6px;
      padding:10px 14px;
      border-radius:8px;
      border:1px solid #ddd;
      text-decoration:none;
      color:#333;
      font-size:15px;
    }
  </style>

  <script>
    // ——————————————————————————
    // ⚙️ CONFIGURACIÓN
    // ——————————————————————————
    const URL_ANDROID_STORE = "https://play.google.com/store/apps/details?id=com.spotify.music";
    const DEEP_LINK_ANDROID = "intent://open.spotify.com/#Intent;scheme=https;package=com.spotify.music;end";
    const URL_IOS_STORE = "https://apps.apple.com/app/id324684580";
    const DEEP_LINK_IOS = "spotify://";
    const TIMEOUT_FAILSAFE  = 1800; // ms antes de asumir que no se abrió la app
    // ——————————————————————————

    function detectPlatform(){
      const ua = navigator.userAgent || navigator.vendor || window.opera || "";
      if (/android/i.test(ua)) return "android";
      if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) return "ios";
      if (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1) return "ios"; // iPadOS
      return "other";
    }

    function tryOpenApp(){
      const platform = detectPlatform();

      if(platform === "android"){
        const start = Date.now();
        window.location = DEEP_LINK_ANDROID;

        setTimeout(() => {
          if (Date.now() - start < TIMEOUT_FAILSAFE + 500) {
            window.location = URL_ANDROID_STORE;
          }
        }, TIMEOUT_FAILSAFE);

      } else if(platform === "ios"){
        const now = Date.now();
        const timeout = setTimeout(() => {
          const elapsed = Date.now() - now;
          if (elapsed < TIMEOUT_FAILSAFE + 1000) {
            window.location = URL_IOS_STORE;
          }
        }, TIMEOUT_FAILSAFE);

        window.location = DEEP_LINK_IOS;

        window.addEventListener('pagehide', () => clearTimeout(timeout));
        window.addEventListener('blur', () => clearTimeout(timeout));

      } else {
        document.getElementById("status").textContent =
          "Abre este enlace desde tu teléfono para probar la redirección a Spotify:";
        document.getElementById("links").style.display = "block";
      }
    }

    window.onload = tryOpenApp;
  </script>
</head>
<body>
  <div class="card">
    <h2>Abriendo Spotify...</h2>
    <p id="status">Si no se abre automáticamente, elige tu tienda:</p>
    <div id="links" style="display:none;">
      <a href="https://play.google.com/store/apps/details?id=com.spotify.music">Google Play</a>
      <a href="https://apps.apple.com/app/id324684580">App Store</a>
      <a href="https://open.spotify.com/">Versión web</a>
    </div>
    <p style="font-size:13px; color:#666; margin-top:12px;">
      Si estás en iPhone, abre este enlace desde Safari.
    </p>
  </div>
</body>
</html>
